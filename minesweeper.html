<!DOCTYPE html>
<html>
<head>
</head>

<body>
	<h1> minesweeper</h1>
<script> "use strict";

	/*
	 Implement minesweeper

	 variables used:
		docobj -- const document object 
		num_rows_k, num_cols_k -- number of rows and columns (10 each)
		init_num_bombs_k -- number of bombs to start (not specified in problem statement)
		remaining_bombs == number of remaining unexploded bombs;
		state_* -- pseudo-enum containing all of the states a cell can have
		images -- array using state_* as index giving the path to the images for each state
		minefield -- a matrix (num_rows_k by num_cols_k) giving hte img objects.
		did_init_bomb -- I won't generate the bomb until after the user makes his first click
			since there's nothing as irritating a hitting a bomb immediately.
		has_bombs -- boolean matrix if a cell has a bomb or not.
		cur_states, new_states -- matrix of current and new state values for each cell.
			The plan is cur_states will be the values as seen by the user and the 
			left and right click functions will update the new_states matrix.  The display
			function will change the minefield matrix as needed and update cur_states to new_states.
	*/
	const docobj = document;
	const num_rows_k = 10, num_cols_k = 10;
	const init_num_bombs_k = 10;
	let num_remaining_bombs = init_num_bombs_k;

	const state_one            =  1; // values for one through eight should match 
	const state_two            =  2; // to make updating new_states a bit easier
	const state_three          =  3;
	const state_four           =  4;
	const state_five           =  5;
	const state_six            =  6;
	const state_seven          =  7;
	const state_eight          =  8; // end matching
	const state_closed         =  9;
	const state_open           = 10;
	const state_incorrect_bomb = 11;
	const state_revealed_bomb  = 12;
	const state_flagged_bomb   = 13;
	const state_exploded_bomb  = 14;

	const images = [];
	images[state_one] = "assets\\one.png";
	images[state_two] = "assets\\two.png";
	images[state_three] = "assets\\three.png";
	images[state_four] = "assets\\four.png";
	images[state_five] = "assets\\five.png";
	images[state_six] = "assets\\six.png";
	images[state_seven] = "assets\\seven.png";
	images[state_eight] = "assets\\eight.png";
	images[state_closed] = "assets\\closed.png";
	images[state_open] = "assets\\open.png";
	images[state_incorrect_bomb] = "assets\\incorrect_bomb.png";
	images[state_revealed_bomb] = "assets\\revealed_bomb.png";
	images[state_flagged_bomb] = "assets\\flagged_bomb.png";
	images[state_exploded_bomb] = "assets\\exploded_bomb.png";

	const minefield = [];
	let did_init_bomb = false;
	const has_bombs = [];
	const cur_states = [];
	const new_states = [];

	function left_func(row, col) // called on left mouse click
	{
		minefield[row][col].src = images[state_revealed_bomb];
		return false; // not really needed, but kept for parallelism with right_func
	} // left_func
	function right_func(row, col) // called on right mouse click
	{
		minefield[row][col].src = images[state_flagged_bomb];
		return false; // prevent the context menu from appearing
	} // right_func

	function init() // called once
	{
		// the remaining bombs display

		const remaining_obj = docobj.createElement("p");
		remaining_obj.innerHTML = "Bombs remaining: " + num_remaining_bombs;
		docobj.body.appendChild(remaining_obj);

		// the minefield:

		// top and left of the minefield (pixels)
		// cell_size_k is the size of a cell
		// ideally these would be based on the browser size, but for now just hard-code them
		const top_pixel_k = 110;
		const left_pixel_k = 100;
		const cell_size_k = 30;

		let cur_top = top_pixel_k;
		for(let row=0; row < num_rows_k; ++row)
		{
			const mine_row = [];
			let cur_left = left_pixel_k;
			for(let col = 0; col < num_cols_k; ++col)
			{
				let imgname = `a${row}{col}`;
				let img = docobj.createElement("img");
				img.name = imgname;
				img.style.display = 'inline';
				img.style.position = 'absolute';
				img.style.top = `${cur_top}px`;
				img.style.left = `${cur_left}px`;
				img.style.width = `${cell_size_k}px`;
				img.src = images[state_closed];
				img.onclick = function() { return left_func(row, col); };
				img.oncontextmenu = function() { return right_func(row, col);};
				docobj.body.appendChild(img);
				mine_row.push(img);
				cur_left += cell_size_k;
			} // for col
			minefield.push(mine_row);
			cur_top += cell_size_k;
		} // for row
	} // init()

	init();
</script>
</body>
</html>
